{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["'use strict'\n\nconst hash = string =>\n  Array.from(string).reduce(\n    (h, ch) => ((h << 5) - h + ch.charCodeAt(0)) & 0xffffffff,\n    0\n  )\n\nconst context = {\n  rules: [],\n  cache: {},\n  hasWindow: typeof window === 'object',\n  isTest:\n    typeof process === 'object' &&\n    process.env &&\n    process.env.NODE_ENV !== 'production'\n}\n\nexport default function stylish (style) {\n  if (Array.isArray(style)) style = style[0]\n  let c = context.cache[style]\n  if (!c) c = context.cache[style] = buildStyle(style)\n  return c\n}\n\n/* istanbul ignore else */\nif (context.isTest) {\n  stylish.context = context\n  /* istanbul ignore if */\n  if (context.hasWindow) {\n    window.$tyli$h = context\n  }\n}\ncontext.stylesheet = createStylesheet()\n\nfunction createStylesheet () {\n  /* istanbul ignore if */\n  if (context.hasWindow) {\n    const el = window.document.createElement('style')\n    return window.document.head.appendChild(el).sheet\n  }\n}\n\nfunction buildStyle (style) {\n  const usi = `stylish-${hash(style).toString(16)}`\n  buildRules(style, usi).forEach(insertRule)\n  return usi\n}\n\nfunction insertRule (rule) {\n  context.rules.push(rule)\n  /* istanbul ignore if */\n  if (context.stylesheet) {\n    context.stylesheet.insertRule(rule, context.stylesheet.cssRules.length)\n  }\n}\n\nfunction parseRules (s) {\n  const r = /([^{}]*([{}]))/gm\n  let n = 0\n  const rules = []\n  let selector\n  let rule\n  while (true) {\n    const match = r.exec(s)\n    if (!match) break\n    if (match[2] === '{') {\n      if (n++ === 0) {\n        selector = match[1].slice(0, -1)\n        rule = '{'\n      } else {\n        rule = rule + match[1]\n      }\n    } else {\n      rule = rule + match[1]\n      if (--n === 0) {\n        rules.push({ selector, rule })\n      }\n    }\n  }\n  return rules\n}\n\nfunction trimRule (rule) {\n  return rule.replace(/\\s*([,>+~;:}{]{1})\\s*/gm, '$1').replace(/;}/g, '}')\n}\n\nfunction buildRules (style, usi) {\n  return parseRules(style).map(({ selector, rule }) => {\n    selector = selector.trim()\n    if (!/^(:root|@)/.test(selector)) {\n      if (!/:self/.test(selector)) {\n        if (/^[+~>]/.test(selector)) {\n          selector = '.:self' + selector\n        } else {\n          selector = '.:self ' + selector\n        }\n      }\n    }\n    selector = selector.replace(/:self/g, usi)\n    rule = trimRule(rule)\n    return selector + rule\n  })\n}\n"],"names":[],"mappings":"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"}