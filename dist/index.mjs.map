{"version":3,"file":"index.mjs","sources":["../src/index.js"],"sourcesContent":["'use strict'\n\nconst hash = string =>\n  Array.from(string).reduce(\n    (h, ch) => ((h << 5) - h + ch.charCodeAt(0)) & 0xffff,\n    0\n  )\n\nconst context = {\n  rules: [],\n  cache: {},\n  hasWindow: typeof window === 'object',\n  isTest:\n    typeof process === 'object' &&\n    process.env &&\n    process.env.NODE_ENV !== 'production'\n}\n\nexport default function stylish (style) {\n  if (Array.isArray(style)) style = style[0]\n  let c = context.cache[style]\n  if (!c) c = context.cache[style] = buildStyle(style)\n  return c\n}\n\n/* istanbul ignore else */\nif (context.isTest) {\n  stylish.context = context\n  /* istanbul ignore if */\n  if (context.hasWindow) {\n    window.$tyli$h = context\n  }\n}\ncontext.stylesheet = createStylesheet()\n\nfunction createStylesheet () {\n  /* istanbul ignore if */\n  if (context.hasWindow) {\n    const el = window.document.createElement('style')\n    return window.document.head.appendChild(el).sheet\n  }\n}\n\nfunction buildStyle (style) {\n  const usi = `stylish-${hash(style).toString(16)}`\n  buildRules(style, usi).forEach(insertRule)\n  return usi\n}\n\nfunction insertRule (rule) {\n  context.rules.push(rule)\n  /* istanbul ignore if */\n  if (context.stylesheet) {\n    context.stylesheet.insertRule(rule, context.stylesheet.cssRules.length)\n  }\n}\n\nfunction parseRules (s) {\n  const r = /([^{}]*([{}]))/gm\n  let n = 0\n  const rules = []\n  let selector\n  let rule\n  while (true) {\n    const match = r.exec(s)\n    if (!match) break\n    if (match[2] === '{') {\n      if (n++ === 0) {\n        selector = match[1].slice(0, -1)\n        rule = '{'\n      } else {\n        rule = rule + match[1]\n      }\n    } else {\n      rule = rule + match[1]\n      if (--n === 0) {\n        rules.push({ selector, rule })\n      }\n    }\n  }\n  return rules\n}\n\nfunction trimRule (rule) {\n  return rule.replace(/\\s*([,>+~;:}{]{1})\\s*/gm, '$1').replace(/;}/g, '}')\n}\n\nfunction buildRules (style, usi) {\n  return parseRules(style).map(({ selector, rule }) => {\n    selector = selector.trim()\n    if (!/^(:root|@)/.test(selector)) {\n      if (!/:self/.test(selector)) {\n        if (/^[+~>]/.test(selector)) {\n          selector = '.:self' + selector\n        } else {\n          selector = '.:self ' + selector\n        }\n      }\n    }\n    selector = selector.replace(/:self/g, usi)\n    rule = trimRule(rule)\n    return selector + rule\n  })\n}\n"],"names":["const","hash","string","Array","from","reduce","h","ch","charCodeAt","context","rules","cache","hasWindow","window","isTest","process","env","NODE_ENV","stylish","style","isArray","c","usi","toString","s","selector","rule","r","n","match","exec","slice","push","parseRules","map","ref","trim","test","replace","trimRule","buildRules","forEach","insertRule","buildStyle","stylesheet","cssRules","length","$tyli$h","el","document","createElement","head","appendChild","sheet","createStylesheet"],"mappings":"AAEAA,IAAMC,WAAOC,UACXC,MAAMC,KAAKF,GAAQG,gBAChBC,EAAGC,UAASD,GAAK,GAAKA,EAAIC,EAAGC,WAAW,GAAM,OAC/C,IAGEC,EAAU,CACdC,MAAO,GACPC,MAAO,GACPC,UAA6B,iBAAXC,OAClBC,OACqB,iBAAZC,SACPA,QAAQC,KACiB,eAAzBD,QAAQC,IAAIC,UAGD,SAASC,EAASC,GAC3BhB,MAAMiB,QAAQD,KAAQA,EAAQA,EAAM,QACpCE,EAAIZ,EAAQE,MAAMQ,UACjBE,IAAGA,EAAIZ,EAAQE,MAAMQ,GAsB5B,SAAqBA,OACbG,EAAO,WAAUrB,EAAKkB,GAAOI,SAAS,WA2C9C,SAAqBJ,EAAOG,UA9B5B,SAAqBE,WAIfC,EACAC,EAJEC,EAAI,mBACNC,EAAI,EACFlB,EAAQ,KAGD,KACLmB,EAAQF,EAAEG,KAAKN,OAChBK,EAAO,MACK,MAAbA,EAAM,GACI,GAARD,KACFH,EAAWI,EAAM,GAAGE,MAAM,GAAI,GAC9BL,EAAO,KAEPA,GAAcG,EAAM,IAGtBH,GAAcG,EAAM,GACR,KAAND,GACJlB,EAAMsB,KAAK,UAAEP,OAAUC,YAItBhB,EAQAuB,CAAWd,GAAOe,aAAKC,oCAC5BV,EAAWA,EAASW,OACf,aAAaC,KAAKZ,IAChB,QAAQY,KAAKZ,KAEdA,EADE,SAASY,KAAKZ,GACL,SAAWA,EAEX,UAAYA,IAI7BA,EAAWA,EAASa,QAAQ,SAAUhB,IAhB1C,SAAmBI,UACVA,EAAKY,QAAQ,0BAA2B,MAAMA,QAAQ,MAAO,KAgB3DC,CAASb,KAvDlBc,CAAWrB,EAAOG,GAAKmB,QAAQC,GACxBpB,EAzB4BqB,CAAWxB,IACvCE,EA2BT,SAASqB,EAAYhB,GACnBjB,EAAQC,MAAMsB,KAAKN,GAEfjB,EAAQmC,YACVnC,EAAQmC,WAAWF,WAAWhB,EAAMjB,EAAQmC,WAAWC,SAASC,QA3BhErC,EAAQK,SACVI,EAAQT,QAAUA,EAEdA,EAAQG,YACVC,OAAOkC,QAAUtC,IAGrBA,EAAQmC,WAER,cAEMnC,EAAQG,UAAW,KACfoC,EAAKnC,OAAOoC,SAASC,cAAc,gBAClCrC,OAAOoC,SAASE,KAAKC,YAAYJ,GAAIK,OAN3BC"}